import os
from randutils import random_string
from buildbot.plugins import steps, util, schedulers, worker, changes

BuildmasterConfig = {
    "title": "",
    "buildbotURL": "http://localhost:8010/",
    "workers": [worker.Worker("worker", random_string(20))],
    "protocols": {"pb": {"port": 9989}},
    "www": {
        "port": 8010,
        "plugins": {"waterfall_view": {}, "console_view": {}, "grid_view": {}},
    },
    "db": {
        "db_url": "sqlite:///state.sqlite",
    },
    "change_source": [
        changes.GitPoller(
            repourl="https://github.com/JoelLefkowitz/pipelines", branches=True
        )
    ],
    "schedulers": [
        schedulers.SingleBranchScheduler(
            name="tester", builderNames=["runtests"], branch="master"
        )
    ],
    "builders": [
        util.BuilderConfig(
            name="runtests",
            workernames=["worker"],
            factory=util.BuildFactory(
                [steps.ShellCommand(name="pytest", command=["pytest"])]
            ),
        ),
    ],
}
